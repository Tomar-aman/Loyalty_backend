{% extends 'custom-admin/base.html' %}
{% load static %}
{% block content %}

<section class="manageActivitiesPage managepadding manageallpage">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <!-- TOP CONTENT START -->
                <div class="topContent">
                    <h2 class="H2Heading">Manage Web Content</h2>
                     <button class="topContentButton" data-bs-toggle="modal" data-bs-target="#addContentModal">
                        <i class="fa fa-plus" aria-hidden="true"></i>
                        Add Content
                    </button>
                </div>
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{% if message.tags == "error" %}danger{% else %}{{message.tags}}{% endif %} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    {% endfor %}
                {% endif %}

                {% comment %} <!-- SEARCH AND FILTER -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <form method="GET" class="mb-4">
                            <div class="input-group">
                                <input type="search" class="customInput searchTable" name="search" 
                                       placeholder="Search by title or content" 
                                       value="{{ search_query }}">
                                <div class="input-group-append">
                                    <button class="btn btn-primary" style="display:none" type="submit">Search</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div> {% endcomment %}

                <!-- TABLE START -->
                <div class="scrollableTable">
                    <table cellpadding="1" cellspacing="1">
                        <tr >
                            <th>ID</th>
                            <th>Title</th>
                            <th>Content Type</th>  <!-- Add this line -->
                            <th>Content</th>
                            <th>Created At</th>
                            <th>Updated At</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                        <tbody>
                            {% if contents %}
                                {% for content in contents %}
                                <tr>
                                    <td>{{ content.id }}</td>
                                    <td>{{ content.title }}</td>
                                    <td>{{ content.content_type }}</td>  <!-- Add this line -->
                                    <td>{{ content.content|striptags|truncatechars:25 }}</td>
                                    <td>{{ content.created_at|date:"d/m/Y" }}</td>
                                    <td>{{ content.updated_at|date:"d/m/Y" }}</td>
                                    <td>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input toggle-status" 
                                                   type="checkbox" 
                                                   {% if content.is_active %}checked{% endif %}
                                                   disabled>
                                        </div>
                                    </td>
                                    <td>
                                        <button class="tableActionBtn edit-content" 
                                                data-content-id="{{ content.id }}"
                                                data-title="{{ content.title }}"
                                                data-content="{{ content.content }}"
                                                data-is-active="{{ content.is_active|lower }}"
                                                data-content-type="{{ content.content_type }}" 
                                                data-edit-url="{% url 'admin_panel:content_edit' content.id %}">
                                            <i class="fa fa-edit"></i>
                                        </button>
                                         <button class="tableActionBtn delete-content" 
                                                data-delete-url="{% url 'admin_panel:content_delete' content.id %}">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="8" class="text-center">No content found.</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>

                    {% comment %} <!-- PAGINATION -->
                    <div class="tablePagination">
                        <nav aria-label="Page navigation">
                            <ul class="pagination">
                                {% if contents.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ contents.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                {% endif %}

                                {% for num in contents.paginator.page_range %}
                                    <li class="page-item {% if contents.number == num %}active{% endif %}">
                                        <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}">{{ num }}</a>
                                    </li>
                                {% endfor %}

                                {% if contents.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ contents.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div> {% endcomment %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Edit Content Modal -->
<div class="modal fade customModal addDataModal" id="editContentModal" tabindex="-1" aria-labelledby="editContentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="H2Heading">Edit Web Content</h6>
                <button type="button" class="hideClose_Modal" data-bs-dismiss="modal">
                    <img src="{% static 'admin/images/close.png' %}" alt="" class="img-fluid">
                </button>
            </div>

            <div class="modal-body">
                <form method="post" id="editContentForm">
                    {% csrf_token %}
                    <div class="row row-gap-4">
                        <div class="col-md-12">
                            <label class="inputLabel">Title</label>
                            <input type="text" name="title" id="edit_title" class="customInput" placeholder="Enter Title">
                        </div>

                        <div class="col-md-12">
                            <label class="inputLabel">Content</label>
                            <textarea name="content" id="edit_content" class="summernote" rows="5" placeholder="Enter Content"></textarea>
                        </div>

                        <div class="col-md-12">
                            <label class="inputLabel">Content Type</label>
                            <div class="customSingleSelect">
                                <div class="select-icon">
                                    <i class="fa fa-angle-down selectIcon"></i>
                                    <select name="content_type" id="edit_content_type" class="icons_select2" single="single" required>
                                        <option value="">Select Content Type</option>
                                        <option value="privacy_policy">Privacy Policy</option>
                                        <option value="terms_and_condition">Terms and Conditions</option>
                                        <option value="about_us">About Us</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <label class="inputLabel">Status</label>
                            <div class="customSingleSelect">
                                <div class="select-icon">
                                    <i class="fa fa-angle-down selectIcon"></i>
                                    <select name="is_active" id="edit_status" class="icons_select2" single="single">
                                        <option value="true">Active</option>
                                        <option value="false">Inactive</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Modal Footer -->
                        <div class="modalFooter">
                            <button type="button" class="customButton" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="customButton ms-2">Update</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Content Modal -->
<div class="modal fade customModal addDataModal" id="addContentModal" tabindex="-1" aria-labelledby="addContentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="H2Heading">Add New Content</h6>
                <button type="button" class="hideClose_Modal" data-bs-dismiss="modal">
                    <img src="{% static 'admin/images/close.png' %}" alt="" class="img-fluid">
                </button>
            </div>

            <div class="modal-body">
                <form method="post" action="{% url 'admin_panel:content_add' %}">
                    {% csrf_token %}
                    <div class="row row-gap-4">
                        <div class="col-md-12">
                            <label class="inputLabel">Title</label>
                            <input type="text" name="title" class="customInput" placeholder="Enter Title" required>
                        </div>

                        <div class="col-md-12">
                            <label class="inputLabel">Content</label>
                            <textarea name="content" class="summernote" rows="5" placeholder="Enter Content" required></textarea>
                        </div>

                        <div class="col-md-12">
                            <label class="inputLabel">Content Type</label>
                            <div class="customSingleSelect">
                                <div class="select-icon">
                                    <i class="fa fa-angle-down selectIcon"></i>
                                    <select name="content_type" class="icons_select2" single="single" required>
                                        <option value="">Select Content Type</option>
                                        <option value="privacy_policy">Privacy Policy</option>
                                        <option value="terms_and_condition">Terms and Conditions</option>
                                        <option value="about_us">About Us</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        {% comment %} <div class="col-md-12">
                            <label class="inputLabel">Status</label>
                            <div class="customSingleSelect">
                                <div class="select-icon">
                                    <i class="fa fa-angle-down selectIcon"></i>
                                    <select name="is_active" class="icons_select2" single="single">
                                        <option value="true">Active</option>
                                        <option value="false">Inactive</option>
                                    </select>
                                </div>
                            </div>
                        </div> {% endcomment %}

                        <div class="modalFooter">
                            <button type="button" class="customButton" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="customButton ms-2">Create</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Delete Content Modal -->
<div class="modal fade customModal addDataModal" id="deleteContentModal" tabindex="-1" aria-labelledby="deleteContentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content text-center" style="height: 340px;">
            <div class="modal-body">
                <img src="{% static 'admin/images/svg-icon/Delete.svg' %}" alt="">
                <form method="post" id="deleteContentForm">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-12 my-4">
                            <h2 class="H2Heading">Confirm Delete</h2>
                            <h5 class="H5Heading mt-3">Are you sure you want to delete this content? This action cannot be undone.</h5>
                        </div>

                        <div class="modalFooter">
                            <button type="button" class="customButton" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="customRedButton ms-3">Delete</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extrajs %}
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
<script>
    $(document).ready(function () {
     //  $('.summernote').summernote();
     $('.summernote').summernote({
      height: 300,
      toolbar: [
      ['style', ['style']],
      ['font', ['bold', 'italic', 'underline', 'clear']],
      ['fontname', ['fontname']],
      ['color', ['color']],
      ['para', ['ul', 'ol', 'paragraph']],
      ['table', ['table']],
      ['insert', ['link', 'picture','video']],
      ['view', ['codeview']]
  ]});
    });
$(document).ready(function() {
    // Edit content modal
    $('.edit-content').click(function() {
        var contentId = $(this).data('content-id');
        var title = $(this).data('title');
        var content = $(this).data('content');
        var isActive = $(this).data('is-active');
        var contentType = $(this).data('content-type');  // Add this line
        var editUrl = $(this).data('edit-url');


        $('#edit_title').val(title);
        $('#edit_content').summernote('code', content);
        $('#edit_content_type').val(contentType).trigger('change.select2');  // Add this line
        $('#edit_status').val(isActive ? "true" : "false").trigger('change.select2');
        $('#editContentModal').modal('show');
        $('#editContentForm').attr('action', editUrl);
    });
      // Delete content modal
    $('.delete-content').click(function() {
        var deleteUrl = $(this).data('delete-url');

        $('#deleteContentForm').attr('action', deleteUrl);
        $('#deleteContentModal').modal('show');
    });
});
</script>
{% endblock %}